{"Root":{"WorkBlockType":3,"PermitTransformation":1,"RequestFormMotivation":0,"StatusAvaiables":null,"StartingStatus":{"Order":0,"BIG_Description":"Avviso di Emergenza in Inserimento","InternalDescription":"Avviso di Emergenza in Inserimento","ExternalDescription":"Avviso di Emergenza in Inserimento","Color":"#a9a9a9","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":{"Html":"{{requestform_MI_HEADER}} <br/><br/>\n{{requestform_MI_AZIENDA}}<br/><br/>\n{{requestform_MI_BODY}}<br/><br/>\n{{requestform_MI_END}}","HeaderHtml":null,"FooterHtml":null,"TenantId":2,"Name":"Avviso di Manomissione","PrintingText":null,"Description":"Avviso di Manomissione","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"307d9e26-fdcd-4643-99c9-015ce80511bb","Id":53},"RequiredPayments":[{"HowToCalculate":1,"Quantity":1,"Amount":20.0000000,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":null,"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"Spese di istruttoria","PrintingText":"Spese di istruttoria","Description":"Spese di istruttoria","IsActive":true,"Order":0,"BIG_Description":"Spese di istruttoria (avvisi di manomissione)","UUID":"c118f210-7a69-4741-b765-ed608406576d","Id":40}],"RFT_Attachments":[],"RFT_StatusAttachments":[{"RFT_Attachment_Id":89,"RFT_Attachment":{"Required":true,"Signed":true,"AdditionalDescription":"questo allegato va inserito SOLO se il richiedente e` diverso dal titolare. Si prega di scaricare il modello, compilarlo e poi inserirlo firmato (digitalmente). Nel caso di firma autografa del delegante, il richiedente dovra` scannerizzare il documento e presentarlo con la sua firma digitale.","DefaultTemplatePath":"Delega_Geoworks.doc","OnlyIfRequesterOtherThanOwner":true,"EvaluationParametersByXPath":null,"RequiredEvaluation":null,"VisibleEvaluation":null,"TenantId":2,"Name":"Delega e dichiarazione di responsabilita` del titolare (Firmata DIgitalmente)","PrintingText":null,"Description":"Delega e dichiarazione di responsabilita` del titolare (Firmata DIgitalmente)","IsActive":true,"Order":0,"BIG_Description":"Delega e dichiarazione di responsabilita` del titolare Firmata DIgitalmente","UUID":"416305b7-8870-4561-b9ba-0da2fd4e981d","Id":89},"AdditionalDescription":"questo allegato va inserito SOLO se il richiedente e` diverso dal titolare. Si prega di scaricare il modello, compilarlo e poi inserirlo firmato (digitalmente). Nel caso di firma autografa del delegante, il richiedente dovra` scannerizzare il documento e presentarlo con la sua firma digitale.","DefaultTemplatePath":"Delega_Geoworks.doc","Required":false,"Signed":false,"OnlyIfRequesterOtherThanOwner":true,"VisibleEvaluation_Id":null,"VisibleEvaluation":null,"RequiredEvaluation_Id":null,"RequiredEvaluation":null,"SignedEvaluation_Id":null,"SignedEvaluation":null,"UUID":"17bf29eb-db49-4f8f-949c-7d4a75374143","Id":64},{"RFT_Attachment_Id":29,"RFT_Attachment":{"Required":true,"Signed":false,"AdditionalDescription":null,"DefaultTemplatePath":null,"OnlyIfRequesterOtherThanOwner":false,"EvaluationParametersByXPath":null,"RequiredEvaluation":null,"VisibleEvaluation":null,"TenantId":2,"Name":"Progetto","PrintingText":null,"Description":"Project","IsActive":true,"Order":0,"BIG_Description":"Progetto","UUID":"aa86b06b-3b23-43d7-84d9-e95b81ce6df8","Id":29},"AdditionalDescription":null,"DefaultTemplatePath":null,"Required":false,"Signed":false,"OnlyIfRequesterOtherThanOwner":false,"VisibleEvaluation_Id":null,"VisibleEvaluation":null,"RequiredEvaluation_Id":null,"RequiredEvaluation":null,"SignedEvaluation_Id":null,"SignedEvaluation":null,"UUID":"c6cec920-9790-4193-8c42-a12f2df91c3e","Id":65}],"DeletableFromCreator":true,"EditableFromCreator":true,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"PROT IN auriga emergenza","InternalDescription":"Al Protocollo","ExternalDescription":"Al Protocollo","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"e773f2be-a4f2-4426-aecf-b27eb815c036","Id":350}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":true,"RequiresPlaningDurationDays":true,"RequiresFromToHours":false,"RequiresExpectedStartEnd":true,"RequiresExpectedFromToHours":true,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":22,"ConditionForExiting":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\nif (RF.ExpectedStart == null)\n{\n\tResult = false;\n\tMessage = \"Pratica non ancora presentabile: Manca data di inizio lavori\";\n\treturn false;\n}\n\nif (RF.ExpectedEnd == null)\n{\n\tResult = false;\n\tMessage = \"Pratica non ancora presentabile: Manca data di fine lavori\";\n\treturn false;\n}\nvar oggi = DateTimeOffset.Now.Date;\n\n\nvar avvisoDays=(RF.ExpectedEnd.Value.Date - RF.ExpectedStart.Value.Date).TotalDays+1;\nif (avvisoDays > 30) \n{\n\tResult = false;\n\tMessage = \"Pratica non ancora presentabile: la durata dei lavori può essere al massimo di 30gg\";\n\treturn false;\n}\n/* PER EMERGENZE NON VALIDO 30 GG\n\nif ((RF.ExpectedStart.Value.Date - oggi).TotalDays < 5) \n{\n\tResult = false;\n\tMessage = \"Pratica non ancora presentabile: la data di inizio deve essere superiore a 5 giorni solari da oggi\";\n\treturn false;\n}\n*/\nif (RF.ExpectedStart.Value.Date>oggi) \n{\n\tResult = false;\n\tMessage = \"Pratica non si può presentare con data inizio lavoro nel futuro.\";\n\treturn false;\n} \n\nif ((oggi - RF.ExpectedStart.Value.Date).TotalDays > 3) \n{\n\tResult = false;\n\tMessage = \"Pratica non ancora presentabile: la data di inizio deve essere minore a 3 giorni solari da oggi\";\n\treturn false;\n} \n\nvar countActivities = CH.Where(x => x.NodeType == EnNodeTreeType.WorkBlock && x.WorkBlock.OccDetail != null).FirstOrDefault().WorkBlock.OccDetail.TypeOfActivities.Count();\nif(countActivities !=1)\n{\nResult = false;\n\tMessage = \"Selezionare un solo tipo di sottoservizio\";\n\treturn false;\n}\n\nvar cut = CH.Where(x => x.NodeType == EnNodeTreeType.Cut).FirstOrDefault();\n\nif (cut == null || cut.Cut == null)\n{\n\tResult = false;\n\tMessage = \"Mancano i dettagli di scavo\";\n\treturn false;\n}\n\n/* non va verificata per gli scavi \nif (cut.Cut.Area > (double)10)\n{\n\tResult = false;\n\tMessage = \"La superficie di taglio deve essere inferiore ai 10 metri quadri per gli Avvisi di Intervento.\";\n\treturn false;\n}\n*/\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif (setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0)\n{\n\tResult = false;\n\tMessage = \"Mancano i dettagli di occupazione\";\n\treturn false;\n}\n\n\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\nif (cantiere != null && (cantiere.Surface<cut.Cut.Area  ))\n{\n\tResult = false;\n\tMessage = \"La superficie di cantiere non può essere inferiore all'area di scavo\";\n\treturn false;\n}\nif (cantiere != null && cantiere.Surface <=(decimal)0)\n{\n\tResult = false;\n\tMessage = \"La superficie di cantiere deve essere maggiore di 0 per le emergenze\";\n\treturn false;\n}\n\n/* non va verificata per gli scavi \n \nif (cantiere != null && (cantiere.Surface > (decimal)30 || cantiere.Surface <=(decimal)0))\n{\n\tResult = false;\n\tMessage = \"La superficie di cantiere deve essere maggiore di 0 e inferiore ai 30 metri quadri per gli Avvisi di Intervento\";\n\treturn false;\n}\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\nif (staging != null && staging.Surface > (decimal)20)\n{\n\tResult = false;\n\tMessage = \"La superficie dell'area di deposito deve essere inferiore ai 20 metri quadri per gli Avvisi di Intervento\";\n\treturn false;\n}\n*/\n/* NON ANCORA DEF PER LE EMERGNEZE\n\n\nif (staging != null && staging.NumberOfDays > (RF.ExpectedEnd.Value.Date - RF.ExpectedStart.Value.Date).TotalDays)\n{\n\tResult = false;\n\tMessage = \"I giorni dell'area di deposito non devono essere superiori alla durata dell'Avvisi di Intervento\";\n\treturn false;\n}\n*/\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\nif (staging != null && (staging.NumberOfDays > avvisoDays) )\n{\n\tResult = false;\n\tMessage = \"I giorni dell'area di deposito non devono essere superiori alla durata dell'emergenza\";\n\treturn false;\n}\n\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Presentazione Avvisi in Emergenza","PrintingText":null,"Description":"Presentazione Avvisi in Emergenza","IsActive":true,"Order":0,"BIG_Description":"Presentazione Avvisi in Emergenza","UUID":"df407c62-773c-4ac1-9e01-8f76653b91c3","Id":22},"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"2dadccdb-673d-4b18-9785-12e5e20879a7","Id":342},"ClearanceRF":false,"ProjectType":null,"RfFromPaperRF":false,"Modified":false,"Version":0,"EnabledRoles":[],"PermitTemplate":{"Title":"Avviso di Intervento","Html":"-","PermitType":1,"GeneratePaymentPlan":true,"DocumentToBeGenerate_Id":53,"DocumentToBeGenerate":{"Html":"{{requestform_MI_HEADER}} <br/><br/>\n{{requestform_MI_AZIENDA}}<br/><br/>\n{{requestform_MI_BODY}}<br/><br/>\n{{requestform_MI_END}}","HeaderHtml":null,"FooterHtml":null,"TenantId":2,"Name":"Avviso di Manomissione","PrintingText":null,"Description":"Avviso di Manomissione","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"307d9e26-fdcd-4643-99c9-015ce80511bb","Id":53},"PermitObject":"","UUID":"71150811-64c0-491b-8d75-3633910fceae","Id":2},"RejectionTemplate":{"Title":"Avviso di Intervento Rigettato","Html":"Avviso di Intervento Rigettato","PermitType":7,"GeneratePaymentPlan":false,"DocumentToBeGenerate_Id":56,"DocumentToBeGenerate":{"Html":"{{requestform_MI_HEADER_riggettato}} <br/><br/>","HeaderHtml":null,"FooterHtml":null,"TenantId":2,"Name":"Avviso di Manomissione - Riggettato","PrintingText":null,"Description":"Avviso di Manomissione - Riggettato","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"2e6c2840-a46f-429a-91f6-8ebbb9291133","Id":56},"PermitObject":null,"UUID":"137806c4-ac03-461c-b4ed-e09f1eff1e95","Id":6},"DisciplinaryTemplate":{"Title":"Avviso di Intervento","Html":"-","PermitType":1,"GeneratePaymentPlan":true,"DocumentToBeGenerate_Id":53,"DocumentToBeGenerate":{"Html":"{{requestform_MI_HEADER}} <br/><br/>\n{{requestform_MI_AZIENDA}}<br/><br/>\n{{requestform_MI_BODY}}<br/><br/>\n{{requestform_MI_END}}","HeaderHtml":null,"FooterHtml":null,"TenantId":2,"Name":"Avviso di Manomissione","PrintingText":null,"Description":"Avviso di Manomissione","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"307d9e26-fdcd-4643-99c9-015ce80511bb","Id":53},"PermitObject":"","UUID":"71150811-64c0-491b-8d75-3633910fceae","Id":2},"SubCategory":{"WorkBlockType":0,"UsedInRfTemplates":7,"TenantId":2,"Name":"Avvisi di Manomissione","PrintingText":null,"Description":"Avvisi di Manomissione","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"06ea9d69-623a-42bd-9bbb-c166be5b080a","Id":1},"ShowPlaningStartAtDay":false,"ShowPlaningDurationDays":false,"ShowFromToHours":false,"ShowExpectedStartEnd":true,"ShowExpectedFromToHours":false,"ShowWorksRealStartEnd":false,"ShowWorksRealFromToHours":false,"ShowCustomDateStart":true,"ShowCustomDateEnd":true,"Tooltip":"Lavoro da eseguire per situazione di pericolo/interruzione di servizio pubblico, in deroga ai consueti parametri","SuffixAsAChild":null,"SelectableParentRfEval_Id":null,"RequestFormsId":[],"UsedTimes":0,"PaymentPlanCalculator_Id":3,"TenantId":2,"Name":"Avviso di Emergenza","PrintingText":null,"Description":"Avviso di Emergenza","IsActive":true,"Order":2,"BIG_Description":"Avviso di Emergenza","UUID":"165fc1e0-b162-422a-a081-4ff46d1bfebb","Id":31},"Leaves":[{"Order":0,"BIG_Description":"PROT IN auriga emergenza","InternalDescription":"Al Protocollo","ExternalDescription":"Al Protocollo","Color":"#ffff00","RequiredProtocol":{"Protocol":{"Name":"Auriga2","Description":"Auriga2","ClassName":"GeoWorks.LibCityProtocollo.ProtocolloAuriga2","Notes":null,"UUID":"468da045-8617-4201-b76b-a03902dd6a34","Id":8},"InOut":1,"AutomaticGenerations":true,"TenantId":2,"Name":"Auriga IN","PrintingText":null,"Description":"Auriga IN","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"bfa61f85-6fbc-44b9-8d07-12f43f9b087a","Id":8},"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":false,"VisibleByInternalUser":false,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":54,"Role":{"Id":54,"RoleId":0,"GrantedPermissionNames":null,"Name":"5f24c656478849919eed716df0c37e03","DisplayName":"---Protocollo Auriga AUTOMATICO"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"89178dc8-8c9e-4bdf-b06d-62bd641e8752","Id":157}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Invio Avviso a PL - emergenza","InternalDescription":"Invio Avviso a PL","ExternalDescription":"Invio Avviso a PL","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"7195554f-ccd6-4176-9a8c-404e2aa1a0e6","Id":386}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"e773f2be-a4f2-4426-aecf-b27eb815c036","Id":350},{"Order":0,"BIG_Description":"Invio Avviso a PL - emergenza","InternalDescription":"Invio Avviso a PL","ExternalDescription":"Invio Avviso a PL","Color":"#121e71","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":false,"VisibleByInternalUser":false,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"3(duplicated)(duplicated)","Description":"3","RoleId":76,"Role":{"Id":76,"RoleId":0,"GrantedPermissionNames":null,"Name":"4200c9998fed459c90edd4404919abd5","DisplayName":"Polizia Locale Zona Tre  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"3","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"c7699c8c-6977-43f9-8c48-14832bf9474f","Id":272},{"Big_Description":"4(duplicated)(duplicated)","Description":"4","RoleId":77,"Role":{"Id":77,"RoleId":0,"GrantedPermissionNames":null,"Name":"60f1b472d634440d8b5e4a22d6aa4f2f","DisplayName":"Polizia Locale Zona Quattro  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"4","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"374aa34e-26e5-4baa-b805-99d1ad293859","Id":273},{"Big_Description":"5(duplicated)(duplicated)","Description":"5","RoleId":78,"Role":{"Id":78,"RoleId":0,"GrantedPermissionNames":null,"Name":"6bea7c96ac8d4d67b9c250636901535b","DisplayName":"Polizia Locale Zona Cinque  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"5","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"081ad4d7-93d7-4527-b5c2-f8d9023f7eb4","Id":274},{"Big_Description":"7(duplicated)(duplicated)","Description":"7","RoleId":80,"Role":{"Id":80,"RoleId":0,"GrantedPermissionNames":null,"Name":"a8631558776a463ca7a0faf2baf5d19d","DisplayName":"Polizia Locale Zona Sette - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"7","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"850fcb6b-291b-4000-96b1-02e4f154318e","Id":275},{"Big_Description":"9(duplicated)(duplicated)","Description":"9","RoleId":82,"Role":{"Id":82,"RoleId":0,"GrantedPermissionNames":null,"Name":"4ac52534e51b47ba9f92d906a666cb1b","DisplayName":"Polizia Locale Zona Nove  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"9","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"753c8fa0-ffd4-43a3-b675-9dc7e5c1e5c5","Id":276},{"Big_Description":"6(duplicated)(duplicated)","Description":"6","RoleId":79,"Role":{"Id":79,"RoleId":0,"GrantedPermissionNames":null,"Name":"ec044e1033c142ef989c0c9f01ca55c2","DisplayName":"Polizia Locale Zona Sei  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"6","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"6c03007c-0ee6-409a-bf79-403b9547ffd4","Id":277},{"Big_Description":"1(duplicated)(duplicated)","Description":"1","RoleId":74,"Role":{"Id":74,"RoleId":0,"GrantedPermissionNames":null,"Name":"476612f457594ce8ad68b0d2158aac81","DisplayName":"Polizia Locale Zona Uno  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"1","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"3a875631-dd7f-48df-ae3d-ddd075083892","Id":278},{"Big_Description":"2(duplicated)(duplicated)","Description":"2","RoleId":75,"Role":{"Id":75,"RoleId":0,"GrantedPermissionNames":null,"Name":"91ab64d666b5467d949f19e2be7df970","DisplayName":"Polizia Locale Zona Due  - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"2","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"c66d02f9-4638-4197-b4f9-cb4b84b153b7","Id":279},{"Big_Description":"8(duplicated)(duplicated)","Description":"8","RoleId":81,"Role":{"Id":81,"RoleId":0,"GrantedPermissionNames":null,"Name":"2e816f95e6954673a9d23bce51f6069b","DisplayName":"Polizia Locale Zona Otto - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":true,"CheckWorkFlowConditionValue":"8","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"0ddf3691-1361-48b7-9249-b2676e17efa2","Id":280},{"Big_Description":"-(duplicated)","Description":"-","RoleId":83,"Role":{"Id":83,"RoleId":0,"GrantedPermissionNames":null,"Name":"9d61b3b519514131b4eb8431fb0f1403","DisplayName":"Polizia Locale Comando Centrale - per invio mail"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"5ab621ea-f899-4d10-bb98-4cb37d6898ce","Id":357}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro in Corso  in Emergenza","InternalDescription":"Lavoro di Emergenza in Corso","ExternalDescription":"Lavoro di Emergenza in Corso","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"26ce4b8e-b19b-40f9-9360-80d1f3243187","Id":331}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":true,"XPathForCalcRfWorkFlowCondition":"(//Trunk/Department)[1]","NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"7195554f-ccd6-4176-9a8c-404e2aa1a0e6","Id":386},{"Order":0,"BIG_Description":"Lavoro in Corso  in Emergenza","InternalDescription":"Lavoro di Emergenza in Corso","ExternalDescription":"Lavoro di Emergenza in Corso","Color":"#1e90ff","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"--","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"2eeedef7-4ccd-4744-b622-c1464cbc8e50","Id":141}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Ripristino Provvisorio Emergenza","InternalDescription":"Ripristino Provvisorio Emergenza","ExternalDescription":"Ripristino Provvisorio Emergenza","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":34,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"f87d0e1a-849e-4116-97dd-eb07356f76a7","Id":363},{"Order":0,"BIG_Description":"Sollecito di Ripristino Provvisorio (emergenza) (-3)","InternalDescription":"Sollecito di Ripristino Provvisorio","ExternalDescription":"Sollecito di Ripristino Provvisorio","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":16,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"b1db5537-4860-4b46-8117-f62abd77ba28","Id":362}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":true,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[{"CreationOrder":0,"ToBeCreated_NodeType":15,"ToBeCreated_Discriminatory":0,"ToBeCreated_FieldToBeCompleted":false,"ToBeCreated_PlaceHolder":false,"CreateUnder_NodeType":12,"CreateUnder_EachOfThisNodeType":false,"CreateUnder_OnlyIfNotAlreadyExist":true,"CreateUnder_Discriminatory":0,"TenantId":0,"Name":null,"PrintingText":null,"Description":null,"IsActive":false,"Order":0,"BIG_Description":null,"UUID":"71d023f9-01c7-4f4a-b8c1-ae5fe5194508","Id":14}],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"26ce4b8e-b19b-40f9-9360-80d1f3243187","Id":331},{"Order":0,"BIG_Description":"Ripristino Provvisorio Emergenza","InternalDescription":"Ripristino Provvisorio Emergenza","ExternalDescription":"Ripristino Provvisorio Emergenza","Color":"#ffa500","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-(duplicated)","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"3cc7a0ec-2a90-4ac4-91ae-333ab8f3ce9a","Id":178}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Sollecito Ripristino Definitivo emergenza (-3)","InternalDescription":"Sollecito Ripristino Definitivo","ExternalDescription":"Sollecito Ripristino Definitivo","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":16,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"6d8692ef-09f6-4c30-8fc6-eea95bcd401c","Id":364},{"Order":0,"BIG_Description":"Lavoro Ultimato (emergenze)","InternalDescription":"Lavoro Ultimato emergenze","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":21,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5c8ba9ab-bff9-4492-bcdc-1ae3a4296881","Id":365},{"Order":0,"BIG_Description":"In Richiesta Rinvio Data di Ripristino Definitivo","InternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","ExternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","AcceptBackBotton":true,"ReleasePermit":false,"RequiresNotes":true,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Richiedi Rinvio Data di Ripristino Definitivo","ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"66713318-ac28-4c95-b363-a54e582595c4","Id":341}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":34,"ConditionForEntering":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateStart== null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la data di ripristino provvisorio. \";\n\n     return false;\n}\n\n\n\nif( RF.CustomDateStart < rfInitDate)\n{\n     Result = false;\n     Message = \"Il ripristino provvisorio deve essere maggiore delle date d'inizio.\";\n\n     return false;\n}\n\nif( RF.CustomDateStart < today.AddDays(-3))\n{\n     Result = false;\n     Message = \"Il ripristino provvisorio deve essere al massimo 3gg prima.\";\n\n     return false;\n}\n\nif( RF.CustomDateStart > today)\n{\n     Result = false;\n     Message = \"Il ripristino provvisorio deve essere compresso tra ieri e oggi.\";\n\n     return false;\n}\n\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check presenza Ripristino Provvisorio Emergenza","PrintingText":null,"Description":"Check presenza Ripristino Provvisorio Emergenza","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"7a6d62ee-5fe4-4925-af74-96b541b9af34","Id":34},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"f87d0e1a-849e-4116-97dd-eb07356f76a7","Id":363},{"Order":0,"BIG_Description":"Sollecito Ripristino Definitivo emergenza (-3)","InternalDescription":"Sollecito Ripristino Definitivo","ExternalDescription":"Sollecito Ripristino Definitivo","Color":"#9932cc","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-(duplicated)","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"05589d3a-8e16-4e71-a26e-8413301a508b","Id":179}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro Ultimato (emergenze)","InternalDescription":"Lavoro Ultimato emergenze","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":21,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5c8ba9ab-bff9-4492-bcdc-1ae3a4296881","Id":365},{"Order":0,"BIG_Description":"In Ripristino Provvisorio  in Possibile Penale","InternalDescription":"In Ripristino Provvisorio  in Possibile Penale","ExternalDescription":"In Ripristino Provvisorio  in Possibile Penale","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":16,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"a30b1eb4-3537-4d6d-922a-e7b17d4744f8","Id":290},{"Order":0,"BIG_Description":"In Richiesta Rinvio Data di Ripristino Definitivo","InternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","ExternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","AcceptBackBotton":true,"ReleasePermit":false,"RequiresNotes":true,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Richiedi Rinvio Data di Ripristino Definitivo","ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"66713318-ac28-4c95-b363-a54e582595c4","Id":341},{"Order":0,"BIG_Description":"Trasformazione emergenza in progetto","InternalDescription":"Trasformazione emergenza in progetto","ExternalDescription":"Trasformazione emergenza in progetto","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"b6e5c910-c3c1-424d-aca2-f2b0a90fceaa","Id":431}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":16,"ConditionForEntering":{"EvaluationParametersByXPath":null,"EvaluationScript":"Result = false;\nMessage = \"\";\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Always false","PrintingText":null,"Description":"Always false","IsActive":true,"Order":0,"BIG_Description":"Always false","UUID":"84fd9839-7965-4753-b6ab-c272095ef9c4","Id":16},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"6d8692ef-09f6-4c30-8fc6-eea95bcd401c","Id":364},{"Order":0,"BIG_Description":"Lavoro Ultimato (emergenze)","InternalDescription":"Lavoro Ultimato emergenze","ExternalDescription":"Lavoro Ultimato","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"int excemptionCOSAP = RF.RequestForm.PaymentExcemptions.Where(x => x.Id == 6).Count();\n \n\nResult = true;\nMessage = \"OK\";\n\nvar res = 0;\n\nif (CurrentPayment.Id==38 && CurrentPayment.TotalDue != null && (decimal)CurrentPayment.TotalDue != 0 && excemptionCOSAP>0)\n{\t\n  \t CurrentPayment.Instalment.TotalDue = 0;\n}\nres = CurrentPayment.Instalment.TotalDue;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Excemption COSAP","PrintingText":null,"Description":"Calcolo Excemption COSAP","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"fd4200a5-5ca0-469a-b10f-0e514a4b8060","Id":36},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":true,"TenantId":2,"Name":"COSAP","PrintingText":null,"Description":"Tax","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"a6d4ea50-80e5-4d44-8aca-531362f18959","Id":38},{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":null,"Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"ok\";\n \n\nvar rfExpectedInitDate = RF.ExpectedStart.Value.Date;          \nvar rfExpectedEndDate = RF.ExpectedEnd.Value.Date;\n\nif(RF.CustomDateStart == null)\n{\n\tMessage = \"no real start date\";\n\treturn 0M;\t\n}\n\n\nvar rfRealInitDate = RF.CustomDateStart.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n var setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif(setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0 || !setup.TrunkSetup.TrunkSetupDetails.Any(y => y.Setup.TypeOfSetup_Id == 2 || y.Setup.TypeOfSetup_Id == 3))\n{\n    Message = \"no parent rf\";\n\treturn 0M;\t\n} \n\nvar cantieriSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 2).Sum(y => y.Surface);\n \n\nif(cantieriSum < 1M)\n{\n    cantieriSum = 1M;\n}\nelse \n{\n    cantieriSum = Math.Ceiling(cantieriSum * 2M) / 2M;\n}\n\nvar depositoSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 3).Sum(y => y.Surface); \n\nif(depositoSum < 1M)\n{\n    depositoSum = 1M;\n}\nelse \n{\n    depositoSum = Math.Ceiling(depositoSum * 2M) / 2M;\n}\n\n\nvar daysMora = (rfRealInitDate - rfExpectedEndDate).Days;\n\nif(daysMora < 1)\n{\n\tMessage = \"no mora\";\t\n\treturn 0M;\n}\n\nvar res = 1.5M * 1.3M * daysMora * (depositoSum + cantieriSum);\nCurrentPayment.Instalment.TotalDue = res;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Mora fine lavori su Ripristino Provvisorio","PrintingText":null,"Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","UUID":"23424817-2a6b-40c5-8433-e373dddb2b97","Id":38},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","PrintingText":"COSAP Maggiorata Sanzione no Proroga 130% su Ripristino Provvisorio","Description":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"COSAP Maggiorata Sanzione finale  130% su Ripristino Provvisorio","UUID":"d1d45a69-631a-44cb-9459-0c0a13ca85df","Id":41}],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-(duplicated)","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"ea1ad549-f26d-4645-bd46-fc4b4c3f327b","Id":180},{"Big_Description":"polizia locale(duplicated)","Description":"polizia locale","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"65564813-bf8a-466d-9e4d-2c894fba428f","Id":181}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro Ultimato senza Anomalie","InternalDescription":"Lavoro Ultimato senza Anomalie","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"05aaa8ca-158d-4c57-8270-f5a9508c57f7","Id":336},{"Order":0,"BIG_Description":"Lavoro Ultimato con Anomalie","InternalDescription":"Lavoro Ultimato con Anomalie","ExternalDescription":"Lavoro Ultimato con Anomalie","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"acb35390-fd3c-4bff-a524-abd4381a3deb","Id":337}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":21,"ConditionForEntering":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n     \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))> RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n    \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))> RF.CustomDateEnd.Value.Date);\n}\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Ripristino Definitivo","PrintingText":null,"Description":"Check Ripristino Definitivo","IsActive":true,"Order":0,"BIG_Description":"Check Ripristino Definitivo","UUID":"ea45d752-94dd-4cbd-b5eb-49263120d9ca","Id":21},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5c8ba9ab-bff9-4492-bcdc-1ae3a4296881","Id":365},{"Order":0,"BIG_Description":"Lavoro Ultimato senza Anomalie","InternalDescription":"Lavoro Ultimato senza Anomalie","ExternalDescription":"Lavoro Ultimato","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":false,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"6d5f54a2-7aaf-4011-a952-ac05ed8c1299","Id":162},{"Big_Description":"-","Description":"-","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"b94e5ae6-4a38-48e3-99c5-580482c73d1f","Id":163}],"AssignToSingleUser":false,"NextStatus":[],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"05aaa8ca-158d-4c57-8270-f5a9508c57f7","Id":336},{"Order":0,"BIG_Description":"Lavoro Ultimato con Anomalie","InternalDescription":"Lavoro Ultimato con Anomalie","ExternalDescription":"Lavoro Ultimato con Anomalie","Color":"#FF4500","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"3001433d-a1b8-4abb-b955-4938e6ba8288","Id":160},{"Big_Description":"-","Description":"-","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"542bcaa9-4ca6-431d-968a-7f62d30d1195","Id":161}],"AssignToSingleUser":false,"NextStatus":[],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"acb35390-fd3c-4bff-a524-abd4381a3deb","Id":337},{"Order":0,"BIG_Description":"In Ripristino Provvisorio  in Possibile Penale","InternalDescription":"In Ripristino Provvisorio  in Possibile Penale","ExternalDescription":"In Ripristino Provvisorio  in Possibile Penale","Color":"#fafad2","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":false,"VisibleByInternalUser":false,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"5d47c7ee-eb4b-4c38-a09d-ef2a46f04430","Id":158}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Ripristino Definitivo con Penale (lavoro ultimato)","InternalDescription":"Ripristino Definitivo con Penale","ExternalDescription":"Ripristino Definitivo con Penale","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":50,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"ca690d40-9880-4ff4-b766-2be028a787b4","Id":284},{"Order":0,"BIG_Description":"Lavoro Ultimato (emergenze)","InternalDescription":"Lavoro Ultimato emergenze","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":21,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5c8ba9ab-bff9-4492-bcdc-1ae3a4296881","Id":365},{"Order":0,"BIG_Description":"Lavoro Ultimato","InternalDescription":"Lavoro Ultimato","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":21,"ConditionForEntering_Id":21,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"df5e03f9-47ef-4575-ae91-0f699aaab93f","Id":277},{"Order":0,"BIG_Description":"Chiuso con penale massima dei 30 giorni e da verificare","InternalDescription":"Chiuso con penale massima dei 30 giorni e da verificare","ExternalDescription":"Chiuso con penale massima dei 30 giorni e da verificare","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":16,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"dd0c411f-79fa-415b-9be8-dcd305fa7ccd","Id":335},{"Order":0,"BIG_Description":"In Richiesta Rinvio Data di Ripristino Definitivo","InternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","ExternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","AcceptBackBotton":true,"ReleasePermit":false,"RequiresNotes":true,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Richiedi Rinvio Data di Ripristino Definitivo","ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"66713318-ac28-4c95-b363-a54e582595c4","Id":341}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":16,"ConditionForEntering":{"EvaluationParametersByXPath":null,"EvaluationScript":"Result = false;\nMessage = \"\";\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Always false","PrintingText":null,"Description":"Always false","IsActive":true,"Order":0,"BIG_Description":"Always false","UUID":"84fd9839-7965-4753-b6ab-c272095ef9c4","Id":16},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"a30b1eb4-3537-4d6d-922a-e7b17d4744f8","Id":290},{"Order":0,"BIG_Description":"Ripristino Definitivo con Penale (lavoro ultimato)","InternalDescription":"Ripristino Definitivo con Penale","ExternalDescription":"Ripristino Definitivo con Penale","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"int excemptionCOSAP = RF.RequestForm.PaymentExcemptions.Where(x => x.Id == 6).Count();\n \n\nResult = true;\nMessage = \"OK\";\n\nvar res = 0;\n\nif (CurrentPayment.Id==38 && CurrentPayment.TotalDue != null && (decimal)CurrentPayment.TotalDue != 0 && excemptionCOSAP>0)\n{\t\n  \t CurrentPayment.Instalment.TotalDue = 0;\n}\nres = CurrentPayment.Instalment.TotalDue;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Excemption COSAP","PrintingText":null,"Description":"Calcolo Excemption COSAP","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"fd4200a5-5ca0-469a-b10f-0e514a4b8060","Id":36},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":true,"TenantId":2,"Name":"COSAP","PrintingText":null,"Description":"Tax","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"a6d4ea50-80e5-4d44-8aca-531362f18959","Id":38},{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":null,"Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"ok\";\n \n\nvar rfExpectedInitDate = RF.ExpectedStart.Value.Date;          \nvar rfExpectedEndDate = RF.ExpectedEnd.Value.Date;\n\nif(RF.CustomDateStart == null)\n{\n\tMessage = \"no real start date\";\n\treturn 0M;\t\n}\n\n\nvar rfRealInitDate = RF.CustomDateStart.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n var setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif(setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0 || !setup.TrunkSetup.TrunkSetupDetails.Any(y => y.Setup.TypeOfSetup_Id == 2 || y.Setup.TypeOfSetup_Id == 3))\n{\n    Message = \"no parent rf\";\n\treturn 0M;\t\n} \n\nvar cantieriSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 2).Sum(y => y.Surface);\n \n\nif(cantieriSum < 1M)\n{\n    cantieriSum = 1M;\n}\nelse \n{\n    cantieriSum = Math.Ceiling(cantieriSum * 2M) / 2M;\n}\n\nvar depositoSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 3).Sum(y => y.Surface); \n\nif(depositoSum < 1M)\n{\n    depositoSum = 1M;\n}\nelse \n{\n    depositoSum = Math.Ceiling(depositoSum * 2M) / 2M;\n}\n\n\nvar daysMora = (rfRealInitDate - rfExpectedEndDate).Days;\n\nif(daysMora < 1)\n{\n\tMessage = \"no mora\";\t\n\treturn 0M;\n}\n\nvar res = 1.5M * 1.3M * daysMora * (depositoSum + cantieriSum);\nCurrentPayment.Instalment.TotalDue = res;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Mora fine lavori su Ripristino Provvisorio","PrintingText":null,"Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","UUID":"23424817-2a6b-40c5-8433-e373dddb2b97","Id":38},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","PrintingText":"COSAP Maggiorata Sanzione no Proroga 130% su Ripristino Provvisorio","Description":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"COSAP Maggiorata Sanzione finale  130% su Ripristino Provvisorio","UUID":"d1d45a69-631a-44cb-9459-0c0a13ca85df","Id":41}],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"polizia locale(duplicated)(duplicated)","Description":"polizia locale","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"7b68cd6a-35e7-4473-90a8-243a7594f256","Id":423},{"Big_Description":"-(duplicated)(duplicated)","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"f38ea521-d047-48f7-9118-76846542e98b","Id":424}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro Ultimato senza Anomalie","InternalDescription":"Lavoro Ultimato senza Anomalie","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"05aaa8ca-158d-4c57-8270-f5a9508c57f7","Id":336},{"Order":0,"BIG_Description":"Lavoro Ultimato con Anomalie","InternalDescription":"Lavoro Ultimato con Anomalie","ExternalDescription":"Lavoro Ultimato con Anomalie","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"acb35390-fd3c-4bff-a524-abd4381a3deb","Id":337}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":50,"ConditionForEntering":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\nMessage = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n    \n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n\n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n      \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))<= RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))<= RF.CustomDateEnd.Value.Date);\n}\n\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check ripristino Definitivo penale","PrintingText":null,"Description":"Check ripristino Definitivo penale","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"6d8cbd0e-d50d-4913-87cb-b465db5f9d59","Id":50},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"ca690d40-9880-4ff4-b766-2be028a787b4","Id":284},{"Order":0,"BIG_Description":"Lavoro Ultimato","InternalDescription":"Lavoro Ultimato","ExternalDescription":"Lavoro Ultimato","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"int excemptionCOSAP = RF.RequestForm.PaymentExcemptions.Where(x => x.Id == 6).Count();\n \n\nResult = true;\nMessage = \"OK\";\n\nvar res = 0;\n\nif (CurrentPayment.Id==38 && CurrentPayment.TotalDue != null && (decimal)CurrentPayment.TotalDue != 0 && excemptionCOSAP>0)\n{\t\n  \t CurrentPayment.Instalment.TotalDue = 0;\n}\nres = CurrentPayment.Instalment.TotalDue;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Excemption COSAP","PrintingText":null,"Description":"Calcolo Excemption COSAP","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"fd4200a5-5ca0-469a-b10f-0e514a4b8060","Id":36},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":true,"TenantId":2,"Name":"COSAP","PrintingText":null,"Description":"Tax","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"a6d4ea50-80e5-4d44-8aca-531362f18959","Id":38},{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":null,"Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"ok\";\n \n\nvar rfExpectedInitDate = RF.ExpectedStart.Value.Date;          \nvar rfExpectedEndDate = RF.ExpectedEnd.Value.Date;\n\nif(RF.CustomDateStart == null)\n{\n\tMessage = \"no real start date\";\n\treturn 0M;\t\n}\n\n\nvar rfRealInitDate = RF.CustomDateStart.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n var setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif(setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0 || !setup.TrunkSetup.TrunkSetupDetails.Any(y => y.Setup.TypeOfSetup_Id == 2 || y.Setup.TypeOfSetup_Id == 3))\n{\n    Message = \"no parent rf\";\n\treturn 0M;\t\n} \n\nvar cantieriSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 2).Sum(y => y.Surface);\n \n\nif(cantieriSum < 1M)\n{\n    cantieriSum = 1M;\n}\nelse \n{\n    cantieriSum = Math.Ceiling(cantieriSum * 2M) / 2M;\n}\n\nvar depositoSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 3).Sum(y => y.Surface); \n\nif(depositoSum < 1M)\n{\n    depositoSum = 1M;\n}\nelse \n{\n    depositoSum = Math.Ceiling(depositoSum * 2M) / 2M;\n}\n\n\nvar daysMora = (rfRealInitDate - rfExpectedEndDate).Days;\n\nif(daysMora < 1)\n{\n\tMessage = \"no mora\";\t\n\treturn 0M;\n}\n\nvar res = 1.5M * 1.3M * daysMora * (depositoSum + cantieriSum);\nCurrentPayment.Instalment.TotalDue = res;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Mora fine lavori su Ripristino Provvisorio","PrintingText":null,"Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","UUID":"23424817-2a6b-40c5-8433-e373dddb2b97","Id":38},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","PrintingText":"COSAP Maggiorata Sanzione no Proroga 130% su Ripristino Provvisorio","Description":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"COSAP Maggiorata Sanzione finale  130% su Ripristino Provvisorio","UUID":"d1d45a69-631a-44cb-9459-0c0a13ca85df","Id":41}],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"6af0338f-b8cf-4d1e-801a-00c9a6379590","Id":142},{"Big_Description":"polizia locale","Description":"polizia locale","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"874aee69-08b1-4b07-a57c-c15a205afee1","Id":148}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro Ultimato senza Anomalie","InternalDescription":"Lavoro Ultimato senza Anomalie","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"05aaa8ca-158d-4c57-8270-f5a9508c57f7","Id":336},{"Order":0,"BIG_Description":"Lavoro Ultimato con Anomalie","InternalDescription":"Lavoro Ultimato con Anomalie","ExternalDescription":"Lavoro Ultimato con Anomalie","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"acb35390-fd3c-4bff-a524-abd4381a3deb","Id":337}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":21,"ConditionForExiting":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n     \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))> RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n    \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))> RF.CustomDateEnd.Value.Date);\n}\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Ripristino Definitivo","PrintingText":null,"Description":"Check Ripristino Definitivo","IsActive":true,"Order":0,"BIG_Description":"Check Ripristino Definitivo","UUID":"ea45d752-94dd-4cbd-b5eb-49263120d9ca","Id":21},"ConditionForEntering_Id":21,"ConditionForEntering":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n     \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))> RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n    \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))> RF.CustomDateEnd.Value.Date);\n}\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Ripristino Definitivo","PrintingText":null,"Description":"Check Ripristino Definitivo","IsActive":true,"Order":0,"BIG_Description":"Check Ripristino Definitivo","UUID":"ea45d752-94dd-4cbd-b5eb-49263120d9ca","Id":21},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"df5e03f9-47ef-4575-ae91-0f699aaab93f","Id":277},{"Order":0,"BIG_Description":"Chiuso con penale massima dei 30 giorni e da verificare","InternalDescription":"Chiuso con penale massima dei 30 giorni e da verificare","ExternalDescription":"Chiuso con penale massima dei 30 giorni e da verificare","Color":"#000000","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"ee1d0d2e-afa0-45a0-ab33-27bcd36d0bb0","Id":159}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Lavoro Ultimato senza Anomalie","InternalDescription":"Lavoro Ultimato senza Anomalie","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"05aaa8ca-158d-4c57-8270-f5a9508c57f7","Id":336},{"Order":0,"BIG_Description":"Lavoro Ultimato con Anomalie","InternalDescription":"Lavoro Ultimato con Anomalie","ExternalDescription":"Lavoro Ultimato con Anomalie","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"acb35390-fd3c-4bff-a524-abd4381a3deb","Id":337}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":16,"ConditionForEntering":{"EvaluationParametersByXPath":null,"EvaluationScript":"Result = false;\nMessage = \"\";\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Always false","PrintingText":null,"Description":"Always false","IsActive":true,"Order":0,"BIG_Description":"Always false","UUID":"84fd9839-7965-4753-b6ab-c272095ef9c4","Id":16},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"dd0c411f-79fa-415b-9be8-dcd305fa7ccd","Id":335},{"Order":0,"BIG_Description":"In Richiesta Rinvio Data di Ripristino Definitivo","InternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","ExternalDescription":"In Richiesta Rinvio Data di Ripristino Definitivo","Color":"#ffa500","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"c984ab7c-9150-4388-bb60-c3541496c0aa","Id":147}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Variazione Data Chiusura Lavori","InternalDescription":"Richiesta Variazione di Data Chiusura Lavori","ExternalDescription":"Variazione Data Chiusura Lavori Richiesta","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Compila QUI e Inoltra Richiesta","ConditionForExiting_Id":47,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"6cdc058a-f7dc-4832-b0dc-5b837a64fd00","Id":339}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":true,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":true,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Richiedi Rinvio Data di Ripristino Definitivo","AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"66713318-ac28-4c95-b363-a54e582595c4","Id":341},{"Order":0,"BIG_Description":"Variazione Data Chiusura Lavori","InternalDescription":"Richiesta Variazione di Data Chiusura Lavori","ExternalDescription":"Variazione Data Chiusura Lavori Richiesta","Color":"#ffa500","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"comune","Description":"comune","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"06aa96c6-adc6-49b8-b5cc-b07381c1a700","Id":145}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Ripristino Provvisorio post variazione Data","InternalDescription":"Ripristino Provvisorio","ExternalDescription":"Ripristino Provvisorio","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Rinvia al Gestore","ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"f6e059e8-d3e0-4437-9086-a03d097aa847","Id":340}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Compila QUI e Inoltra Richiesta","AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":47,"ConditionForExiting":{"EvaluationParametersByXPath":"","EvaluationScript":"Message = \"OK\";\n            Result = true;\n\n \n\n \n\n            var dataConcUffEnti = CH.Where(x => x.FilledReview_Id != null && x.FilledReview.Review_Template.Id == 77).ToList().FirstOrDefault();\n            if (dataConcUffEnti != null)\n            {\n                var dataConcStr = dataConcUffEnti.FilledReview.FilledAnswers.Where(x => x.Answer_Id == 324).FirstOrDefault()?.FilledData;\n                if (string.IsNullOrWhiteSpace(dataConcStr))\n                {\n                    Message = \"Riempire la data concessa\";\n                    Result = false;\n                    return false;\n                }\n            }\n            else\n            {\n                Message = \"Riempire la data concessa\";\n                Result = false;\n                return false;\n            }\n            return Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check DATA VARIAZIONE UFF ENTI","PrintingText":null,"Description":"Check DATA VARIAZIONE UFF ENTI","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"f528c43e-477e-48c8-95dd-3fb1ef487853","Id":47},"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"6cdc058a-f7dc-4832-b0dc-5b837a64fd00","Id":339},{"Order":0,"BIG_Description":"Ripristino Provvisorio post variazione Data","InternalDescription":"Ripristino Provvisorio","ExternalDescription":"Ripristino Provvisorio","Color":"#ffa500","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"48121887-d076-43fb-a548-65e0b3f5808a","Id":146}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"[ Copy Of] Lavoro Ultimato","InternalDescription":"Lavoro Ultimato","ExternalDescription":"Lavoro Ultimato","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":21,"ConditionForEntering_Id":53,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5189b954-c56c-4628-b279-96ce09c0610c","Id":402},{"Order":0,"BIG_Description":"Lavoro Ultimato con penale","InternalDescription":"Lavoro Ultimato con penale","ExternalDescription":"Lavoro Ultimato con penale","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":21,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"c876bff9-377a-4d60-9b15-b46653b2a302","Id":410}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":"Rinvia al Gestore","AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"f6e059e8-d3e0-4437-9086-a03d097aa847","Id":340},{"Order":0,"BIG_Description":"[ Copy Of] Lavoro Ultimato","InternalDescription":"Lavoro Ultimato","ExternalDescription":"Lavoro Ultimato","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"int excemptionCOSAP = RF.RequestForm.PaymentExcemptions.Where(x => x.Id == 6).Count();\n \n\nResult = true;\nMessage = \"OK\";\n\nvar res = 0;\n\nif (CurrentPayment.Id==38 && CurrentPayment.TotalDue != null && (decimal)CurrentPayment.TotalDue != 0 && excemptionCOSAP>0)\n{\t\n  \t CurrentPayment.Instalment.TotalDue = 0;\n}\nres = CurrentPayment.Instalment.TotalDue;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Excemption COSAP","PrintingText":null,"Description":"Calcolo Excemption COSAP","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"fd4200a5-5ca0-469a-b10f-0e514a4b8060","Id":36},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":true,"TenantId":2,"Name":"COSAP","PrintingText":null,"Description":"Tax","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"a6d4ea50-80e5-4d44-8aca-531362f18959","Id":38},{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":null,"Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"ok\";\n \n\nvar rfExpectedInitDate = RF.ExpectedStart.Value.Date;          \nvar rfExpectedEndDate = RF.ExpectedEnd.Value.Date;\n\nif(RF.CustomDateStart == null)\n{\n\tMessage = \"no real start date\";\n\treturn 0M;\t\n}\n\n\nvar rfRealInitDate = RF.CustomDateStart.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n var setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif(setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0 || !setup.TrunkSetup.TrunkSetupDetails.Any(y => y.Setup.TypeOfSetup_Id == 2 || y.Setup.TypeOfSetup_Id == 3))\n{\n    Message = \"no parent rf\";\n\treturn 0M;\t\n} \n\nvar cantieriSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 2).Sum(y => y.Surface);\n \n\nif(cantieriSum < 1M)\n{\n    cantieriSum = 1M;\n}\nelse \n{\n    cantieriSum = Math.Ceiling(cantieriSum * 2M) / 2M;\n}\n\nvar depositoSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 3).Sum(y => y.Surface); \n\nif(depositoSum < 1M)\n{\n    depositoSum = 1M;\n}\nelse \n{\n    depositoSum = Math.Ceiling(depositoSum * 2M) / 2M;\n}\n\n\nvar daysMora = (rfRealInitDate - rfExpectedEndDate).Days;\n\nif(daysMora < 1)\n{\n\tMessage = \"no mora\";\t\n\treturn 0M;\n}\n\nvar res = 1.5M * 1.3M * daysMora * (depositoSum + cantieriSum);\nCurrentPayment.Instalment.TotalDue = res;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Mora fine lavori su Ripristino Provvisorio","PrintingText":null,"Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","UUID":"23424817-2a6b-40c5-8433-e373dddb2b97","Id":38},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","PrintingText":"COSAP Maggiorata Sanzione no Proroga 130% su Ripristino Provvisorio","Description":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"COSAP Maggiorata Sanzione finale  130% su Ripristino Provvisorio","UUID":"d1d45a69-631a-44cb-9459-0c0a13ca85df","Id":41}],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"polizia locale","Description":"polizia locale","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"93030f57-2553-4268-aae6-1a33e5d1b63f","Id":430},{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"407142ba-93e2-4ab5-874d-5d2b8116a5a1","Id":431}],"AssignToSingleUser":false,"NextStatus":[],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":21,"ConditionForExiting":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n     \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))> RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n    \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))> RF.CustomDateEnd.Value.Date);\n}\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Ripristino Definitivo","PrintingText":null,"Description":"Check Ripristino Definitivo","IsActive":true,"Order":0,"BIG_Description":"Check Ripristino Definitivo","UUID":"ea45d752-94dd-4cbd-b5eb-49263120d9ca","Id":21},"ConditionForEntering_Id":53,"ConditionForEntering":{"EvaluationParametersByXPath":"","EvaluationScript":"Message = \"OK\";\n            Result = true;\n\n \n\n \n\n            var dataConcUffEnti = CH.Where(x => x.FilledReview_Id != null && x.FilledReview.Review_Template.Id == 77).ToList().FirstOrDefault();\n            if (dataConcUffEnti != null)\n            {\n                var dataConcStr = dataConcUffEnti.FilledReview.FilledAnswers.Where(x => x.Answer_Id == 324).FirstOrDefault()?.FilledData;\n                if (string.IsNullOrWhiteSpace(dataConcStr))\n                {\n                    Message = \"Riempire la data concessa\";\n                    Result = false;\n                    return false;\n                }\n            }\n            else\n            {\n                Message = \"Riempire la data concessa\";\n                Result = false;\n                return false;\n            }\nif(RF.CustomDateEnd>DateTime.Parse(dataConcStr))\n{\n     Message = \"La data deve essere minore o uguale di quella concessa\";\n                Result = false;\n                return false;\n}\n\n\n            return Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Data Uff Enti Rip Def Variazione","PrintingText":null,"Description":"Check Data Uff Enti Rip Def Variazione","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"d315f255-8add-4e63-beb2-bf5d776526c0","Id":53},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"5189b954-c56c-4628-b279-96ce09c0610c","Id":402},{"Order":0,"BIG_Description":"Lavoro Ultimato con penale","InternalDescription":"Lavoro Ultimato con penale","ExternalDescription":"Lavoro Ultimato con penale","Color":"#006400","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":"","Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"int excemptionCOSAP = RF.RequestForm.PaymentExcemptions.Where(x => x.Id == 6).Count();\n \n\nResult = true;\nMessage = \"OK\";\n\nvar res = 0;\n\nif (CurrentPayment.Id==38 && CurrentPayment.TotalDue != null && (decimal)CurrentPayment.TotalDue != 0 && excemptionCOSAP>0)\n{\t\n  \t CurrentPayment.Instalment.TotalDue = 0;\n}\nres = CurrentPayment.Instalment.TotalDue;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Excemption COSAP","PrintingText":null,"Description":"Calcolo Excemption COSAP","IsActive":false,"Order":0,"BIG_Description":null,"UUID":"fd4200a5-5ca0-469a-b10f-0e514a4b8060","Id":36},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":true,"TenantId":2,"Name":"COSAP","PrintingText":null,"Description":"Tax","IsActive":true,"Order":0,"BIG_Description":null,"UUID":"a6d4ea50-80e5-4d44-8aca-531362f18959","Id":38},{"HowToCalculate":2,"Quantity":1,"Amount":0.0,"CodeRequired":false,"CodeRequiredDescr":"","AdditionalDescription":null,"Signed":false,"Exemptible":false,"CalculationEval":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"ok\";\n \n\nvar rfExpectedInitDate = RF.ExpectedStart.Value.Date;          \nvar rfExpectedEndDate = RF.ExpectedEnd.Value.Date;\n\nif(RF.CustomDateStart == null)\n{\n\tMessage = \"no real start date\";\n\treturn 0M;\t\n}\n\n\nvar rfRealInitDate = RF.CustomDateStart.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n var setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nif(setup == null || setup.TrunkSetup == null || setup.TrunkSetup.TrunkSetupDetails.Count == 0 || !setup.TrunkSetup.TrunkSetupDetails.Any(y => y.Setup.TypeOfSetup_Id == 2 || y.Setup.TypeOfSetup_Id == 3))\n{\n    Message = \"no parent rf\";\n\treturn 0M;\t\n} \n\nvar cantieriSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 2).Sum(y => y.Surface);\n \n\nif(cantieriSum < 1M)\n{\n    cantieriSum = 1M;\n}\nelse \n{\n    cantieriSum = Math.Ceiling(cantieriSum * 2M) / 2M;\n}\n\nvar depositoSum = setup.TrunkSetup.TrunkSetupDetails.Where(y => y.Setup.TypeOfSetup_Id == 3).Sum(y => y.Surface); \n\nif(depositoSum < 1M)\n{\n    depositoSum = 1M;\n}\nelse \n{\n    depositoSum = Math.Ceiling(depositoSum * 2M) / 2M;\n}\n\n\nvar daysMora = (rfRealInitDate - rfExpectedEndDate).Days;\n\nif(daysMora < 1)\n{\n\tMessage = \"no mora\";\t\n\treturn 0M;\n}\n\nvar res = 1.5M * 1.3M * daysMora * (depositoSum + cantieriSum);\nCurrentPayment.Instalment.TotalDue = res;\nreturn res;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Calcolo Mora fine lavori su Ripristino Provvisorio","PrintingText":null,"Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"Calcolo Mora fine lavori su Ripristino Provvisorio","UUID":"23424817-2a6b-40c5-8433-e373dddb2b97","Id":38},"Required":false,"VATPerc":0.0,"CheckInstalmentsToPay":false,"TenantId":2,"Name":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","PrintingText":"COSAP Maggiorata Sanzione no Proroga 130% su Ripristino Provvisorio","Description":"COSAP Maggiorata Sanzione finale 130% su Ripristino Provvisorio","IsActive":true,"Order":0,"BIG_Description":"COSAP Maggiorata Sanzione finale  130% su Ripristino Provvisorio","UUID":"d1d45a69-631a-44cb-9459-0c0a13ca85df","Id":41}],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-","Description":"-","RoleId":52,"Role":{"Id":52,"RoleId":0,"GrantedPermissionNames":null,"Name":"161310c886ca4869968b2729595c4892","DisplayName":"Unità Tecnica Suolo e Sottosuolo - Ufficio Enti"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"337706c4-22d4-4976-971e-a72160a23ca4","Id":445},{"Big_Description":"polizia locale","Description":"polizia locale","RoleId":51,"Role":{"Id":51,"RoleId":0,"GrantedPermissionNames":null,"Name":"74272189acd543e49668a041fe035cda","DisplayName":"Polizia Locale Comando Centrale"},"OpenType":6,"AssignableForSingleUser":false,"BackToCreator":false,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":"","AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"22220f05-cb52-4260-b2ef-2a46104310ad","Id":446}],"AssignToSingleUser":false,"NextStatus":[],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":true,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":21,"ConditionForExiting":{"EvaluationParametersByXPath":"","EvaluationScript":"Result = true;\nMessage = \"Pratica Presentabile\";\n\n\nvar rfInitDate = RF.ExpectedStart.Value.Date;          \nvar rfEndDate = RF.ExpectedEnd.Value.Date;\n\nvar today= DateTimeOffset.Now.Date;\n\nif( RF.CustomDateEnd == null )\n{\n     Result = false;\n     Message = \"Pratica non presentabile: Manca la di ripristino definitivo\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd < RF.CustomDateStart)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere maggiore della date di ripristino provvisorio.\";\n\n     return false;\n}\n\nvar daysBefore = (RF.RequestForm.Template.Id==25 || RF.RequestForm.Template.Id==26?-1:-3);\n\nif( RF.CustomDateEnd < today.AddDays(daysBefore))\n{\n     Result = false;\n     Message = $\"Il ripristino definitivo deve essere compreso tra oggi e {daysBefore} giorni da oggi.\";\n\n     return false;\n}\n\nif( RF.CustomDateEnd > today)\n{\n     Result = false;\n     Message = \"Il ripristino definitivo deve essere compreso tra ieri e oggi.\";\n\n     return false;\n}\n\n\nvar referenceDate = RF.CustomDateStart!=null? RF.CustomDateStart  : RF.ExpectedEnd;\n\nvar isCarreggiata = (RF.RequestForm.Template.Id==33 || RF.RequestForm.Template.Id==34);\n\nvar setup = CH.Where(x => x.NodeType == EnNodeTreeType.TrunkSetup).FirstOrDefault();\n\nvar cantiere = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 2).FirstOrDefault();\n\n\nif (cantiere != null && cantiere.AffectedArea!=null && (cantiere.AffectedArea.Id==5 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==13 || cantiere.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n\n\n\nvar staging = setup.TrunkSetup.TrunkSetupDetails.Where(x => x.Setup?.TypeOfSetup?.Id == 3).FirstOrDefault();\n\n\nif (staging != null && staging.AffectedArea!=null && (staging.AffectedArea.Id==5 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==13 || staging.AffectedArea.Id==16))\n{\n    isCarreggiata = true;\n}\n\n \n/* carreggiata: 30 giorni-3 -- marciapiede: 15 gg- 3 */\n\n\nif(isCarreggiata)\n{\n     \n     Message = \"La data deve essere al massimo entro 30gg\";\n    Result = (referenceDate.Value.Date.AddDays((double)(30+1))> RF.CustomDateEnd.Value.Date);\n}\nelse {\n    Message = \"La data deve essere al massimo entro 15gg\";\n    \n    Result = (referenceDate.Value.Date.AddDays((double)(15+1))> RF.CustomDateEnd.Value.Date);\n}\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Check Ripristino Definitivo","PrintingText":null,"Description":"Check Ripristino Definitivo","IsActive":true,"Order":0,"BIG_Description":"Check Ripristino Definitivo","UUID":"ea45d752-94dd-4cbd-b5eb-49263120d9ca","Id":21},"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"c876bff9-377a-4d60-9b15-b46653b2a302","Id":410},{"Order":0,"BIG_Description":"Trasformazione emergenza in progetto","InternalDescription":"Trasformazione emergenza in progetto","ExternalDescription":"Trasformazione emergenza in progetto","Color":"#1E90FF","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":true,"VisibleByInternalUser":true,"CustomJSFuncName":"goToNextStatus","Roles":[],"AssignToSingleUser":false,"NextStatus":[],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":false,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":null,"ConditionForEntering":null,"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"b6e5c910-c3c1-424d-aca2-f2b0a90fceaa","Id":431},{"Order":0,"BIG_Description":"Sollecito di Ripristino Provvisorio (emergenza) (-3)","InternalDescription":"Sollecito di Ripristino Provvisorio","ExternalDescription":"Sollecito di Ripristino Provvisorio","Color":"#d596f5","RequiredProtocol":null,"RequiredSignedDocument":null,"DocumentToBeGenerate":null,"RequiredPayments":[],"RFT_Attachments":[],"RFT_StatusAttachments":[],"DeletableFromCreator":false,"EditableFromCreator":false,"VisibleByExternalUser":false,"VisibleByInternalUser":false,"CustomJSFuncName":"goToNextStatus","Roles":[{"Big_Description":"-(duplicated)","Description":"-","RoleId":6,"Role":{"Id":6,"RoleId":0,"GrantedPermissionNames":null,"Name":"d4bc886a18dd47498a80913de580852f","DisplayName":"Utente Esterno"},"OpenType":11,"AssignableForSingleUser":false,"BackToCreator":true,"AssignToLastUserWithThisRole":false,"DonTAssignIfLastUserWithThisRoleIsEmpty":false,"CheckWorkFlowCondition":false,"CheckWorkFlowConditionValue":null,"AssignToContractorQualificationLegalEntityOrgUnitUsers_Id":null,"AssignToNextUserInRole":false,"AssignToChangeStatusUser":false,"StatusId":0,"UUID":"3c289e50-2f79-4545-ab50-c28b8a676e52","Id":177}],"AssignToSingleUser":false,"NextStatus":[{"Order":0,"BIG_Description":"Ripristino Provvisorio Emergenza","InternalDescription":"Ripristino Provvisorio Emergenza","ExternalDescription":"Ripristino Provvisorio Emergenza","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":34,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"f87d0e1a-849e-4116-97dd-eb07356f76a7","Id":363},{"Order":0,"BIG_Description":"Trasformazione emergenza in progetto","InternalDescription":"Trasformazione emergenza in progetto","ExternalDescription":"Trasformazione emergenza in progetto","AcceptBackBotton":false,"ReleasePermit":false,"RequiresNotes":false,"RequiresNotesOptional":false,"GeneratePermit":false,"GenerateRejection":false,"GenerateDisciplinary":false,"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"ConditionForExiting_Id":null,"ConditionForEntering_Id":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"b6e5c910-c3c1-424d-aca2-f2b0a90fceaa","Id":431}],"RFT_Opinions":[],"CreateAlwaysOpinionsGroupNode":false,"OpinionsGroupNodeTitle":null,"AcceptBackBotton":false,"ReleasePermit":false,"GeneratePermit":true,"GenerateRejection":false,"GenerateDisciplinary":false,"RequiresPlaningStartAtDay":false,"RequiresPlaningDurationDays":false,"RequiresFromToHours":false,"RequiresExpectedStartEnd":false,"RequiresExpectedFromToHours":false,"RequiresWorksRealStart":false,"RequiresWorksRealEnd":false,"RequiresWorksRealFromToHours":false,"RequiresCustomDateStart":true,"RequiresCustomDateEnd":false,"RequiresCustomDate2Start":false,"RequiresCustomDate2End":false,"AttachmentsAdditionalInformation":null,"PaymentsAdditionalInformation":null,"CloseOpenIntegrationRequests":false,"RequiresNotes":false,"RequiresNotesOptional":false,"OpinionsStatusToWaitingAnswer":false,"OpinionsStatusToClose":false,"ActionButtonLabel":null,"AcceptanceOfClauses":false,"AcceptanceOfClausesText":null,"CalcRfWorkFlowCondition":false,"XPathForCalcRfWorkFlowCondition":null,"NodesToBeCreated":[],"ConditionForExiting_Id":null,"ConditionForExiting":null,"ConditionForEntering_Id":16,"ConditionForEntering":{"EvaluationParametersByXPath":null,"EvaluationScript":"Result = false;\nMessage = \"\";\nreturn Result;","ExtStatus":[],"EntStatus":[],"PayStatus":[],"TenantId":2,"Name":"Always false","PrintingText":null,"Description":"Always false","IsActive":true,"Order":0,"BIG_Description":"Always false","UUID":"84fd9839-7965-4753-b6ab-c272095ef9c4","Id":16},"DocumentForNextStatus":[],"DistributionListToSet_Id":null,"DistributionListToSet":null,"SiblingRfTemplatesToCreate":[],"CrtdFrmRfGotoToThisStatus_Id":null,"WorkProgress":0,"UUID":"b1db5537-4860-4b46-8117-f62abd77ba28","Id":362}]}